{"version":3,"sources":["src/tierpoints-calculator-component.js"],"names":["BaseComponent","translate","translations","template","constructor","$template","$program","connectedCallback","hasAttribute","getAttribute","$points_label","$awardmiles_label","$status_labels","split","el_status","querySelector","forEach","status","index","el_option","document","createElement","value","innerHTML","appendChild","query","itineraries","body","JSON","stringify","map","itinerary","ticketer","ticketingCarrier","price","baseFare","currency","segments","fetch","method","headers","then","response","json","calculate_totals","display","data","airlines","airports","totals","el_list","el_thead","$locale","status_key","cabinclass","Y","W","C","F","$segments","segment","earning","find","item","id","el","distance","toLocaleString","origin","location","destination","carrier","name","bookingClass","bookingclass","fare","success","errorMessage","rdm","qm","el_foot"],"mappings":"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","sourceRoot":"/source_map/","sourcesContent":["import BaseComponent from \"./base-component\";\nimport translate from \"./helper/translate\";\nimport translations from \"./translations\";\nimport template from \"./templates/tierpoints-calculator\";\n\nexport default class extends BaseComponent {\n  constructor() {\n    super();\n    this.$template = template;\n    this.$program = \"BA\";\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.$program = this.hasAttribute(\"program\")\n      ? this.getAttribute(\"program\")\n      : \"BA\";\n    this.$points_label = this.hasAttribute(\"points_label\")\n      ? this.getAttribute(\"points_label\")\n      : null;\n    this.$awardmiles_label = this.hasAttribute(\"awardmiles_label\")\n      ? this.getAttribute(\"awardmiles_label\")\n      : null;\n    this.$status_labels = this.hasAttribute(\"status_labels\")\n      ? this.getAttribute(\"status_labels\").split(\",\")\n      : [\"None\", \"Silver\", \"Gold\", \"Platinum\"];\n\n    this.el_status = this.querySelector('[name=\"status\"]');\n    this.$status_labels.forEach((status, index) => {\n      let el_option = document.createElement(\"option\");\n      el_option.value = index;\n      el_option.innerHTML = status;\n      this.el_status.appendChild(el_option);\n    });\n  }\n\n  async query(itineraries) {\n    //for (var i = 0; i < itineraries.length; i++) {\n    //  if (i > 0) {\n    //console.log(itineraries[i]);\n    //    itineraries[i].price = 0;\n    //  }\n    //}\n    let body = JSON.stringify(\n      itineraries.map((itinerary) => {\n        return {\n          ...(itinerary.ticketer\n            ? { ticketingCarrier: itinerary.ticketer }\n            : { ticketingCarrier: \"null\" }),\n          ...(itinerary.price\n            ? { baseFare: itinerary.price, currency: itinerary.currency }\n            : { baseFare: 0 }),\n          segments: [itinerary],\n        };\n      })\n    );\n\n    fetch(\n      \"https://mileage.travel-dealz.eu/api/calculate/mileage?programs=\" +\n        this.$program,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body,\n      }\n    )\n      .then((response) => response.json())\n      .then((response) => this.calculate_totals(response));\n    // .catch(error => {\n    //   this.loading_end();\n    //   this.el_error.innerHTML = `Error: ${error.toString()}`;\n    //   this.el_error.classList.remove('hidden');\n    // });\n  }\n\n  display({ value: data, airlines, airports }, totals) {\n    super.display();\n    this.el_list.innerHTML = \"\";\n\n    let el_thead = document.createElement(\"thead\");\n    el_thead.innerHTML = translate(\n      /*html*/ `\n      <tr>\n        <th></th>\n        <th class=\"text-center\">__(Route)</th>\n        <th class=\"text-center\">__(Bookingclass)</th>\n        <th class=\"text-right\">${\n          this.$awardmiles_label ? this.$awardmiles_label : \"__(Award Miles)\"\n        }</th>\n        <th class=\"text-right\">${\n          this.$points_label ? this.$points_label : \"__(Points)\"\n        }</th>\n      </tr>\n    `,\n      translations[this.$locale] ? translations[this.$locale] : []\n    );\n    this.el_list.appendChild(el_thead);\n\n    const status_key = this.el_status.value;\n\n    const cabinclass = {\n      Y: \"Economy\",\n      W: \"Premium Eco\",\n      C: \"Business\",\n      F: \"First\",\n    };\n\n    this.$segments.forEach((segment, index) => {\n      const earning = data[index].value.totals.find(\n        (item) => item.id === this.$program\n      );\n\n      let el = document.createElement(\"tr\");\n      el.innerHTML = translate(\n        /*html*/ `\n        <td class=\"align-top text-vertical text-center text-xs text-grey-dark font-light\">${data[\n          index\n        ].value.distance?.toLocaleString()} __(miles)</td>\n        <td class=\"text-center\">\n          <div class=\"grid grid-cols-1 md:grid-cols-2\">\n            <div>\n              <div><code>${segment.origin}</code></div>\n              <div class=\"text-xs text-grey-dark font-light\">${\n                airports[segment.origin]?.location\n              }</div>\n            </div>\n            <div>\n              <div><code>${segment.destination}</code></div>\n              <div class=\"text-xs text-grey-dark font-light\">${\n                airports[segment.destination]?.location\n              }</div>\n            </div>\n          </div>\n        </td>\n        <td class=\"text-center\">\n          <div class=\"grid grid-cols-1 md:grid-cols-2\">\n            <div>\n              <div><code>${segment.carrier}</code></div>\n              <div class=\"text-xs text-grey-dark font-light\">${\n                airlines[segment.carrier]?.name\n              }</div>\n            </div>\n            <div>\n              <div><code>${segment.bookingClass}</code></div>\n              <div class=\"text-xs text-grey-dark font-light\">${\n                airlines[segment.carrier]?.bookingclass\n                  ? cabinclass[\n                      airlines[segment.carrier]?.bookingclass[\n                        segment.bookingClass\n                      ]?.cabinclass\n                    ]\n                  : \"\"\n              } ${\n          airlines[segment.carrier]?.bookingclass\n            ? airlines[segment.carrier]?.bookingclass.fare\n              ? airlines[segment.carrier]?.bookingclass[segment.bookingClass]\n                  ?.fare\n              : \"\"\n            : \"\"\n        }</div>\n            </div>\n          </div>\n        </td>\n        <td class=\"text-right\">${\n          false === data[index].success\n            ? data[index].errorMessage\n            : `${earning.rdm ? earning.rdm[status_key]?.toLocaleString() : \"-\"}`\n        }</td>\n        <td class=\"text-right\">${\n          false === data[index].success\n            ? data[index].errorMessage\n            : `${earning.qm ? earning.qm[0]?.toLocaleString() : 0}`\n        }</td>\n        `,\n        translations[this.$locale] ? translations[this.$locale] : []\n      );\n      this.el_list.appendChild(el);\n    });\n    let el_foot = document.createElement(\"tfoot\");\n\n    el_foot.innerHTML = translate(\n      /*html*/ `\n      <tr>\n        <th class=\"text-right\" colspan=\"3\">__(Total)</th>\n        <th class=\"text-right\">${\n          totals[this.$program].rdm\n            ? totals[this.$program].rdm[status_key]?.toLocaleString()\n            : 0\n        }</th>\n        <th class=\"text-right\">${totals[this.$program].qm[\n          status_key\n        ]?.toLocaleString()}</th>\n      </tr>\n    `,\n      translations[this.$locale] ? translations[this.$locale] : []\n    );\n    this.el_list.appendChild(el_foot);\n  }\n}\n"]}