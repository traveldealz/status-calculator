{"version":3,"sources":["src/tierpoints-calculator-component.js"],"names":["BaseComponent","translate","translations","template","constructor","$template","$program","connectedCallback","hasAttribute","getAttribute","$points_label","$awardmiles_label","$status_labels","split","el_status","querySelector","forEach","status","index","el_option","document","createElement","value","innerHTML","appendChild","query","itineraries","body","JSON","stringify","map","itinerary","price","ticketingCarrier","ticketer","baseFare","segments","fetch","method","headers","then","response","json","calculate_totals","display","data","airlines","airports","totals","el_list","el_thead","$locale","status_key","cabinclass","Y","W","C","F","$segments","segment","earning","find","item","id","el","distance","toLocaleString","origin","location","destination","carrier","name","bookingClass","bookingclass","fare","success","errorMessage","rdm","qm","el_foot"],"mappings":"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","sourceRoot":"/source_map/","sourcesContent":["import BaseComponent from './base-component';\nimport translate from './helper/translate';\nimport translations from './translations';\nimport template from './templates/tierpoints-calculator';\n\nexport default class extends BaseComponent {\n  constructor() {\n    super();\n    this.$template = template;\n    this.$program = 'BA';\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.$program = this.hasAttribute('program') ? this.getAttribute('program') : 'BA';\n    this.$points_label = this.hasAttribute('points_label') ? this.getAttribute('points_label') : null;\n    this.$awardmiles_label = this.hasAttribute('awardmiles_label') ? this.getAttribute('awardmiles_label') : null;\n    this.$status_labels = this.hasAttribute('status_labels') ? this.getAttribute('status_labels').split(',') : ['None','Silver','Gold','Platinum'];\n\n    this.el_status = this.querySelector('[name=\"status\"]');\n    this.$status_labels.forEach((status, index) => {\n      let el_option = document.createElement('option');\n      el_option.value = index;\n      el_option.innerHTML = status;\n      this.el_status.appendChild(el_option);\n    });\n  }\n\n  async query(itineraries) {\n\n    let body = JSON.stringify(itineraries.map( itinerary => { return {\n      ...itinerary.price ? { ticketingCarrier: itinerary.ticketer } : {ticketingCarrier: \"null\"},\n      ...itinerary.price ? { baseFare: itinerary.price } : {baseFare: 0},\n      segments: [itinerary]\n    } } ));\n\n    fetch('https://farecollection.travel-dealz.de/api/calculate/mileage?programs=BA', {\n      method: 'POST',\n      headers: {\n      'Content-Type': 'application/json'\n      },\n      body,\n    })\n    .then(response => response.json())\n    .then(response => this.calculate_totals(response))\n    // .catch(error => {\n    //   this.loading_end();\n    //   this.el_error.innerHTML = `Error: ${error.toString()}`;\n    //   this.el_error.classList.remove('hidden');\n    // });\n  }\n\n  display( {value: data, airlines, airports}, totals ) {\n\n    super.display();\n    this.el_list.innerHTML = '';\n\n    let el_thead = document.createElement('thead');\n    el_thead.innerHTML = translate(/*html*/`\n      <tr>\n        <th></th>\n        <th class=\"text-center\">__(Route)</th>\n        <th class=\"text-center\">__(Bookingclass)</th>\n        <th class=\"text-right\">${ this.$awardmiles_label ? this.$awardmiles_label : '__(Award Miles)'}</th>\n        <th class=\"text-right\">${ this.$points_label ? this.$points_label : '__(Points)'}</th>\n      </tr>\n    `, translations[this.$locale] ? translations[this.$locale] : []);\n    this.el_list.appendChild(el_thead);\n\n    const status_key = this.el_status.value;\n\n    const cabinclass = {\n      Y: 'Economy',\n      W: 'Premium Eco',\n      C: 'Business',\n      F: 'First',\n    };\n\n    this.$segments.forEach( (segment, index) => {\n\n    const earning = data[index].value.totals.find( item => item.id === this.$program );\n\n      let el = document.createElement('tr');\n        el.innerHTML = translate(/*html*/`\n        <td class=\"align-top text-vertical text-center text-xs text-grey-dark font-light\">${data[index].value.distance?.toLocaleString()} __(miles)</td>\n        <td class=\"text-center\">\n          <div class=\"grid grid-cols-1 md:grid-cols-2\">\n            <div>\n              <div><code>${segment.origin}</code></div>\n              <div class=\"text-xs text-grey-dark font-light\">${airports[segment.origin]?.location}</div>\n            </div>\n            <div>\n              <div><code>${segment.destination}</code></div>\n              <div class=\"text-xs text-grey-dark font-light\">${airports[segment.destination]?.location}</div>\n            </div>\n          </div>\n        </td>\n        <td class=\"text-center\">\n          <div class=\"grid grid-cols-1 md:grid-cols-2\">\n            <div>\n              <div><code>${segment.carrier}</code></div>\n              <div class=\"text-xs text-grey-dark font-light\">${airlines[segment.carrier]?.name}</div>\n            </div>\n            <div>\n              <div><code>${segment.bookingClass}</code></div>\n              <div class=\"text-xs text-grey-dark font-light\">${airlines[segment.carrier]?.bookingclass ? cabinclass[airlines[segment.carrier]?.bookingclass[segment.bookingClass]?.cabinclass] : ''} ${airlines[segment.carrier]?.bookingclass ? airlines[segment.carrier]?.bookingclass[segment.bookingClass]?.fare : ''}</div>\n            </div>\n          </div>\n        </td>\n        <td class=\"text-right\">${ false === data[index].success ? data[index].errorMessage : `${earning.rdm ? earning.rdm[status_key]?.toLocaleString() : '-'}` }</td>\n        <td class=\"text-right\">${ false === data[index].success ? data[index].errorMessage : `${earning.qm ? earning.qm[0]?.toLocaleString() : 0}` }</td>\n        `, translations[this.$locale] ? translations[this.$locale] : []);\n        this.el_list.appendChild(el);\n    } );\n    let el_foot = document.createElement('tfoot');\n\n    el_foot.innerHTML = translate(/*html*/`\n      <tr>\n        <th class=\"text-right\" colspan=\"3\">__(Total)</th>\n        <th class=\"text-right\">${totals[this.$program].rdm ? totals[this.$program].rdm[status_key]?.toLocaleString() : 0}</th>\n        <th class=\"text-right\">${totals[this.$program].qm[status_key]?.toLocaleString()}</th>\n      </tr>\n    `, translations[this.$locale] ? translations[this.$locale] : []);\n    this.el_list.appendChild(el_foot);\n\n  }\n\n}"]}