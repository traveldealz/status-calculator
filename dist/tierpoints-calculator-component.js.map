{"version":3,"sources":["src/tierpoints-calculator-component.js"],"names":["BaseComponent","translate","translations","template","constructor","$template","$program","connectedCallback","hasAttribute","getAttribute","$points_label","$awardmiles_label","$status_labels","split","el_status","querySelector","forEach","status","index","el_option","document","createElement","value","innerHTML","appendChild","query","itineraries","body","JSON","stringify","map","itinerary","ticketer","ticketingCarrier","price","baseFare","currency","segments","fetch","method","headers","then","response","json","calculate_totals","display","data","airlines","airports","totals","el_list","totalqm","totalrm","el_thead","$locale","status_key","cabinclass","Y","W","C","F","$segments","segment","earning","find","item","id","rd_status_key","rdm","length","qm_status_key","qm","el","distance","toLocaleString","origin","location","destination","carrier","name","bookingClass","bookingclass","fare","success","errorMessage","el_foot"],"mappings":"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","sourceRoot":"/source_map/","sourcesContent":["import BaseComponent from \"./base-component\";\nimport translate from \"./helper/translate\";\nimport translations from \"./translations\";\nimport template from \"./templates/tierpoints-calculator\";\n\nexport default class extends BaseComponent {\n  constructor() {\n    super();\n    this.$template = template;\n    this.$program = \"BA\";\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.$program = this.hasAttribute(\"program\")\n      ? this.getAttribute(\"program\")\n      : \"BA\";\n    this.$points_label = this.hasAttribute(\"points_label\")\n      ? this.getAttribute(\"points_label\")\n      : null;\n    this.$awardmiles_label = this.hasAttribute(\"awardmiles_label\")\n      ? this.getAttribute(\"awardmiles_label\")\n      : null;\n    this.$status_labels = this.hasAttribute(\"status_labels\")\n      ? this.getAttribute(\"status_labels\").split(\",\")\n      : [\"None\", \"Silver\", \"Gold\", \"Platinum\"];\n\n    this.el_status = this.querySelector('[name=\"status\"]');\n    this.$status_labels.forEach((status, index) => {\n      let el_option = document.createElement(\"option\");\n      el_option.value = index;\n      el_option.innerHTML = status;\n      this.el_status.appendChild(el_option);\n    });\n  }\n\n  async query(itineraries) {\n    //for (var i = 0; i < itineraries.length; i++) {\n    //  if (i > 0) {\n    //console.log(itineraries[i]);\n    //    itineraries[i].price = 0;\n    //  }\n    //}\n    let body = JSON.stringify(\n      itineraries.map((itinerary) => {\n        return {\n          ...(itinerary.ticketer\n            ? { ticketingCarrier: itinerary.ticketer }\n            : { ticketingCarrier: \"null\" }),\n          ...(itinerary.price\n            ? { baseFare: itinerary.price, currency: itinerary.currency }\n            : { baseFare: 0 }),\n          segments: [itinerary],\n        };\n      })\n    );\n\n    fetch(\n      \"https://mileage.travel-dealz.eu/api/calculate/mileage?programs=\" +\n        this.$program,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body,\n      }\n    )\n      .then((response) => response.json())\n      .then((response) => this.calculate_totals(response));\n    // .catch(error => {\n    //   this.loading_end();\n    //   this.el_error.innerHTML = `Error: ${error.toString()}`;\n    //   this.el_error.classList.remove('hidden');\n    // });\n  }\n\n  display({ value: data, airlines, airports }, totals) {\n    super.display();\n    this.el_list.innerHTML = \"\";\n    let totalqm = 0;\n    let totalrm = 0;\n    let el_thead = document.createElement(\"thead\");\n    el_thead.innerHTML = translate(\n      /*html*/ `\n      <tr>\n        <th></th>\n        <th class=\"text-center\">__(Route)</th>\n        <th class=\"text-center\">__(Bookingclass)</th>\n        <th class=\"text-right\">${\n          this.$awardmiles_label ? this.$awardmiles_label : \"__(Award Miles)\"\n        }</th>\n        <th class=\"text-right\">${\n          this.$points_label ? this.$points_label : \"__(Points)\"\n        }</th>\n      </tr>\n    `,\n      translations[this.$locale] ? translations[this.$locale] : []\n    );\n    this.el_list.appendChild(el_thead);\n\n    const status_key = this.el_status.value;\n    const cabinclass = {\n      Y: \"Economy\",\n      W: \"Premium Eco\",\n      C: \"Business\",\n      F: \"First\",\n    };\n\n    this.$segments.forEach((segment, index) => {\n      const earning = data[index].value.totals.find(\n        (item) => item.id === this.$program\n      );\n\n      let rd_status_key = status_key;\n      status_key > earning.rdm.length - 1\n        ? (rd_status_key = earning.rdm.length - 1)\n        : {};\n\n      let qm_status_key = status_key;\n      status_key > earning.qm.length - 1\n        ? (qm_status_key = earning.qm.length - 1)\n        : {};\n\n      earning.rdm ? (totalrm += earning.rdm[rd_status_key]) : {};\n      earning.qm ? (totalqm += earning.qm[qm_status_key]) : {};\n\n      let el = document.createElement(\"tr\");\n      el.innerHTML = translate(\n        /*html*/ `\n        <td class=\"align-top text-vertical text-center text-xs text-grey-dark font-light\">${data[\n          index\n        ].value.distance?.toLocaleString()} __(miles)</td>\n        <td class=\"text-center\">\n          <div class=\"grid grid-cols-1 md:grid-cols-2\">\n            <div>\n              <div><code>${segment.origin}</code></div>\n              <div class=\"text-xs text-grey-dark font-light\">${\n                airports[segment.origin]?.location\n              }</div>\n            </div>\n            <div>\n              <div><code>${segment.destination}</code></div>\n              <div class=\"text-xs text-grey-dark font-light\">${\n                airports[segment.destination]?.location\n              }</div>\n            </div>\n          </div>\n        </td>\n        <td class=\"text-center\">\n          <div class=\"grid grid-cols-1 md:grid-cols-2\">\n            <div>\n              <div><code>${segment.carrier}</code></div>\n              <div class=\"text-xs text-grey-dark font-light\">${\n                airlines[segment.carrier]?.name\n              }</div>\n            </div>\n            <div>\n              <div><code>${segment.bookingClass}</code></div>\n              <div class=\"text-xs text-grey-dark font-light\">${\n                airlines[segment.carrier]?.bookingclass\n                  ? cabinclass[\n                      airlines[segment.carrier]?.bookingclass[\n                        segment.bookingClass\n                      ]?.cabinclass\n                    ]\n                  : \"\"\n              } ${\n          airlines[segment.carrier]?.bookingclass\n            ? airlines[segment.carrier]?.bookingclass.fare\n              ? airlines[segment.carrier]?.bookingclass[segment.bookingClass]\n                  ?.fare\n              : \"\"\n            : \"\"\n        }</div>\n            </div>\n          </div>\n        </td>\n        <td class=\"text-right\">${\n          false === data[index].success\n            ? data[index].errorMessage\n            : `${\n                earning.rdm ? earning.rdm[rd_status_key]?.toLocaleString() : \"-\"\n              }`\n        }</td>\n        <td class=\"text-right\">${\n          false === data[index].success\n            ? data[index].errorMessage\n            : `${earning.qm ? earning.qm[qm_status_key]?.toLocaleString() : 0}`\n        }</td>\n        `,\n        translations[this.$locale] ? translations[this.$locale] : []\n      );\n      this.el_list.appendChild(el);\n    });\n    let el_foot = document.createElement(\"tfoot\");\n\n    el_foot.innerHTML = translate(\n      /*html*/ `\n      <tr>\n        <th class=\"text-right\" colspan=\"3\">__(Total)</th>\n        <th class=\"text-right\">${totalrm.toLocaleString()}</th>\n        <th class=\"text-right\">${totalqm.toLocaleString()}</th>\n      </tr>\n    `,\n      translations[this.$locale] ? translations[this.$locale] : []\n    );\n    this.el_list.appendChild(el_foot);\n  }\n}\n"]}