{"version":3,"sources":["src/base-component.js"],"names":["template","translate","translations","HTMLElement","constructor","$template","$segments","connectedCallback","$locale","hasAttribute","getAttribute","navigator","language","split","$currency","innerHTML","el_route","querySelector","el_list","el_button","el_loading","el_error","addEventListener","event","preventDefault","loading_start","calculate","replaceAll","location","hash","loadParameters","itineraries","value","trim","map","parts","v","carrier","bookingClass","route","ticketer","price","currency","match","reduce","accumulator","airport","index","push","origin","destination","parseInt","flat","update_hash","query","elem","warningSpan","document","createElement","className","parentNode","insertBefore","body","JSON","stringify","itinerary","ticketingCarrier","baseFare","segments","Promise","all","fetch","method","headers","then","responses","response","json","merge_responses","calculate_totals","catch","error","loading_end","toString","classList","remove","td_data","wtc_data","console","log","success","errorMessage","segment","segmentIndex","ids","Set","totals","program","id","wtc_total","find","item","qm","rdm","qd","forEach","m","i","display","data","disabled","add","searchParams","URLSearchParams","replace","el","key","keys","type","checked","get","parameters","querySelectorAll","name"],"mappings":"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","sourceRoot":"/source_map/","sourcesContent":["import template from \"./templates/base\";\nimport translate from \"./helper/translate\";\nimport translations from \"./translations\";\n\nexport default class extends HTMLElement {\n  constructor() {\n    super();\n    this.$template = template;\n    this.$segments = [];\n  }\n\n  connectedCallback() {\n    this.$locale = this.hasAttribute(\"locale\")\n      ? this.getAttribute(\"locale\")\n      : navigator.language\n      ? navigator.language\n      : \"en\";\n    this.$locale = this.$locale.split(\"-\")[0];\n\n    this.$currency = this.hasAttribute(\"currency\")\n      ? this.getAttribute(\"currency\")\n      : \"EUR\";\n\n    this.innerHTML = translate(\n      this.$template,\n      translations[this.$locale] ? translations[this.$locale] : []\n    );\n\n    this.el_route = this.querySelector('[name=\"route\"]');\n    this.el_list = this.querySelector(\"#list\");\n    this.el_button = this.querySelector('button[type=\"submit\"]');\n    this.el_loading = this.querySelector(\".loading\");\n    this.el_error = this.querySelector(\".error\");\n\n    this.querySelector(\"form\").addEventListener(\"submit\", (event) => {\n      event.preventDefault();\n      this.loading_start();\n      this.calculate();\n    });\n\n    if (this.hasAttribute(\"route\")) {\n      this.querySelector('[name=\"route\"]').innerHTML = this.getAttribute(\n        \"route\"\n      ).replaceAll(\",\", \"\\n\");\n    }\n\n    if (location.hash) {\n      this.loadParameters();\n    }\n  }\n\n  calculate() {\n    let itineraries = this.el_route.value\n      .trim()\n      .split(\"\\n\")\n      .map((value) => {\n        let parts = value.split(\":\").map((v) => v.trim());\n        let carrier = parts[0];\n        let bookingClass = parts[1];\n        let route = parts[2].split(\"-\").map((v) => v.trim());\n        let ticketer = parts[3];\n        let price = parts[4];\n        let currency =\n          parts[4] && parts[4].match(/[A-Z]{3}|[$€£]/u)\n            ? parts[4].match(/[A-Z]{3}|[$€£]/u)[0]\n            : this.$currency;\n\n        return route.reduce((accumulator, airport, index, route) => {\n          if (0 === index || !accumulator) {\n            return accumulator;\n          }\n          accumulator.push({\n            carrier,\n            bookingClass,\n            origin: route[index - 1],\n            destination: airport,\n            ticketer,\n            price: index == 1 ? parseInt(price) : 0,\n            currency,\n          });\n          return accumulator;\n        }, []);\n      })\n      .flat();\n    this.$segments = itineraries.flat();\n    this.update_hash();\n    this.query(itineraries);\n\n    for (elem in this.$segments.carrier) {\n      if (elem.carrier == \"AY\") {\n        var warningSpan = document.createElement(\"span\");\n        warningSpan.className = \"redTextClass\";\n        warningSpan.innerHTML =\n          \"Leider können wir die Finnair-Plus-Punkte für Finnair-Flüge nicht berechnen\";\n        this.parentNode.insertBefore(warningSpan, this);\n        //alert('Leider können wir die Finnair-Plus-Punkte für Finnair-Flüge nicht berechnen' );\n      }\n    }\n  }\n\n  async query(itineraries) {\n    let body = JSON.stringify(\n      itineraries.map((itinerary) => {\n        return {\n          ...(itinerary.ticketer\n            ? { ticketingCarrier: itinerary.ticketer }\n            : {}),\n          ...(itinerary.price\n            ? { baseFare: itinerary.price, currency: itinerary.currency }\n            : {}),\n          segments: [itinerary],\n        };\n      })\n    );\n\n    Promise.all([\n      fetch(\"https://mileage.travel-dealz.eu/api/calculate/mileage\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body,\n      }),\n      fetch(\"https://www.wheretocredit.com/api/2.0/calculate\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body,\n      }),\n    ])\n      .then((responses) =>\n        Promise.all(responses.map((response) => response.json()))\n      )\n      .then((responses) => this.merge_responses(responses[0], responses[1]))\n      .then((response) => this.calculate_totals(response))\n      .catch((error) => {\n        this.loading_end();\n        this.el_error.innerHTML = `Error: ${error.toString()}`;\n        this.el_error.classList.remove(\"hidden\");\n      });\n  }\n\n  merge_responses(td_data, wtc_data) {\n    let response = {\n      ...wtc_data,\n      ...td_data,\n    };\n\n    console.log(td_data);\n\n    if (false === wtc_data.success && true === response.success) {\n      response.success = wtc_data.success;\n      response.errorMessage = wtc_data.errorMessage;\n    }\n\n    response.value = response.value.map((segment, segmentIndex) => {\n      segment = {\n        ...segment,\n\n        value: {\n          ...(wtc_data.value[segmentIndex].value\n            ? wtc_data.value[segmentIndex].value\n            : {}),\n          ...segment.value,\n        },\n      };\n\n      if (\n        false === wtc_data.value[segmentIndex].success &&\n        true === segment.success\n      ) {\n        segment.success = wtc_data.value[segmentIndex].success;\n        segment.errorMessage = wtc_data.value[segmentIndex].errorMessage;\n      }\n\n      let ids = [\n        ...new Set([\n          ...segment.value.totals.map((program) => program.id),\n          ...(wtc_data.value[segmentIndex].value\n            ? wtc_data.value[segmentIndex].value.totals.map(\n                (program) => program.id\n              )\n            : []),\n        ]),\n      ];\n\n      let totals = ids.map((program) => {\n        let wtc_total = wtc_data.value[segmentIndex].value?.totals?.find(\n          (item) => program === item.id\n        )\n          ? wtc_data.value[segmentIndex].value.totals.find(\n              (item) => program === item.id\n            )\n          : {};\n        return {\n          ...wtc_total,\n          qm: wtc_total.rdm ? wtc_total.rdm : [0, 0, 0, 0],\n          qd: wtc_total.qd ? wtc_total.qd : 0,\n          ...segment.value.totals.find((item) => program === item.id),\n        };\n      });\n\n      segment.value.totals = totals;\n\n      return segment;\n    });\n\n    if (false === response.success) {\n      throw response.errorMessage;\n    }\n\n    response.value.forEach((item) => {\n      if (false === item.success) {\n        throw item.errorMessage;\n      }\n    });\n\n    return response;\n  }\n\n  calculate_totals(response) {\n    let totals = response.value.reduce((totals, itinerary) => {\n      itinerary.value.totals.forEach((item) => {\n        item.rdm\n          ? (totals[item.id] = totals[item.id]\n              ? {\n                  rdm: totals[item.id].rdm\n                    ? totals[item.id].rdm.map((m, i) => m + item.rdm[i])\n                    : item.rdm,\n                  qm: totals[item.id].qm.map((m, i) => m + item.qm[i]),\n                  qd: totals[item.id].qd + item.qd,\n                }\n              : {\n                  rdm: item.rdm,\n                  qm: item.qm,\n                  qd: item.qd,\n                })\n          : {};\n      });\n\n      return totals;\n    }, {});\n\n    this.display(response, totals);\n  }\n\n  display(data, totals) {\n    this.loading_end();\n  }\n\n  loading_start() {\n    this.el_button.disabled = true;\n    this.el_list.innerHTML = \"\";\n    this.el_loading.classList.remove(\"hidden\");\n    this.el_error.classList.add(\"hidden\");\n    this.el_error.innerHTML = \"\";\n  }\n\n  loading_end() {\n    this.el_button.disabled = false;\n    this.el_loading.classList.add(\"hidden\");\n  }\n\n  loadParameters() {\n    let searchParams = new URLSearchParams(location.hash.replace(\"#\", \"\"));\n    let el = {};\n    for (let key of searchParams.keys()) {\n      el = this.querySelector(`[name=\"${key}\"]`);\n      if (el) {\n        \"checkbox\" === el.type\n          ? (el.checked = \"true\" === searchParams.get(key))\n          : (el.value = searchParams.get(key));\n      }\n    }\n  }\n\n  update_hash() {\n    let parameters = {};\n    [...this.querySelectorAll(\"[name]\")].forEach(\n      (el) =>\n        (parameters[el.name] = \"checkbox\" === el.type ? el.checked : el.value)\n    );\n    location.hash = new URLSearchParams(parameters).toString();\n  }\n}\n"]}