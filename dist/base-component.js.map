{"version":3,"sources":["src/base-component.js"],"names":["template","translate","translations","HTMLElement","constructor","$template","$segments","connectedCallback","$locale","hasAttribute","getAttribute","navigator","language","split","innerHTML","el_route","querySelector","el_list","el_button","el_loading","el_error","addEventListener","event","preventDefault","loading_start","calculate","replaceAll","location","hash","loadParameters","itineraries","value","trim","map","parts","v","carrier","bookingClass","route","ticketer","price","parseInt","length","reduce","accumulator","airport","index","push","origin","destination","flat","update_hash","query","body","JSON","stringify","itinerary","ticketingCarrier","baseFare","segments","Promise","all","fetch","method","headers","then","responses","response","json","merge_responses","calculate_totals","catch","error","loading_end","toString","classList","remove","td_data","wtc_data","success","errorMessage","segment","segmentIndex","ids","Set","totals","program","id","wtc_total","find","item","qm","rdm","qd","forEach","console","log","m","i","display","data","disabled","add","searchParams","URLSearchParams","replace","el","key","keys","type","checked","get","parameters","querySelectorAll","name"],"mappings":"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","sourceRoot":"/source_map/","sourcesContent":["import template from './templates/base';\nimport translate from './helper/translate';\nimport translations from './translations';\n\nexport default class extends HTMLElement {\n  constructor() {\n    super();\n    this.$template = template;\n    this.$segments = [];\n  }\n\n  connectedCallback() {\n\n    this.$locale = this.hasAttribute('locale') ? this.getAttribute('locale') : navigator.language ? navigator.language : 'en';\n    this.$locale = this.$locale.split('-')[0];\n\n    this.innerHTML = translate(this.$template, translations[this.$locale] ? translations[this.$locale] : []);\n\n    this.el_route = this.querySelector('[name=\"route\"]');\n    this.el_list = this.querySelector('#list');\n    this.el_button = this.querySelector('button[type=\"submit\"]');\n    this.el_loading = this.querySelector('.loading');\n    this.el_error = this.querySelector('.error');\n\n    this.querySelector('form').addEventListener('submit', (event) => {\n      event.preventDefault();\n      this.loading_start();\n      this.calculate();\n    });\n\n    if ( this.hasAttribute('route') ) {\n      this.querySelector('[name=\"route\"]').innerHTML = this.getAttribute('route').replaceAll(',', '\\n');\n    }\n\n    if ( location.hash ) {\n\t\t\tthis.loadParameters();\n\t\t}\n\n  }\n\n  calculate() {\n\n    let itineraries = this.el_route.value\n      .trim()\n      .split('\\n')\n      .map(value => {\n        let parts = value.split(':').map(v => v.trim());\n        let carrier = parts[0];\n        let bookingClass = parts[1];\n        let route = parts[2].split('-').map(v => v.trim());\n        let ticketer = parts[3];\n        let price = parseInt(parts[4]/(parts[2].split('-').length - 1));\n        \n        return route.reduce((accumulator, airport, index, route) => {\n          if(0 === index || ! accumulator) {\n            return accumulator;\n          }\n          accumulator.push({\n            carrier,\n            bookingClass,\n            origin: route[index-1],\n            destination: airport,\n            ticketer,\n            price,\n          });\n          return accumulator;\n        }, []);\n\n      })\n      .flat();\n    this.$segments = itineraries.flat();\n    this.update_hash();\n    this.query(itineraries);\n  }\n\n  async query(itineraries) {\n\n    let body = JSON.stringify(itineraries.map( itinerary => { return {\n      ...itinerary.price ? { ticketingCarrier: itinerary.ticketer } : {ticketingCarrier: \"null\"},\n      ...itinerary.price ? { baseFare: itinerary.price } : {baseFare: 0},\n      segments: [itinerary]\n    } } ));\n\n    Promise.all([\n      fetch('https://farecollection.travel-dealz.de/api/calculate/tierpoints', {\n        method: 'POST',\n        headers: {\n        'Content-Type': 'application/json'\n        },\n        body,\n      }),\n      fetch('https://www.wheretocredit.com/api/2.0/calculate', {\n        method: 'POST',\n        headers: {\n        'Content-Type': 'application/json'\n        },\n        body,\n      }),\n    ])\n    .then(responses => Promise.all(responses.map(response => response.json())))\n    .then(responses => this.merge_responses(responses[0], responses[1]))\n    .then(response => this.calculate_totals(response))\n    .catch(error => {\n      this.loading_end();\n      this.el_error.innerHTML = `Error: ${error.toString()}`;\n      this.el_error.classList.remove('hidden');\n    });\n  }\n\n  merge_responses( td_data, wtc_data ) {\n\n    let response = {\n      ...wtc_data,\n      ...td_data,\n    };\n\n    if( false === wtc_data.success && true === response.success ) {\n      response.success = wtc_data.success;\n      response.errorMessage = wtc_data.errorMessage;\n    }\n\n    response.value = response.value.map( (segment, segmentIndex) => {\n\n      segment = {\n        ...segment,\n\n        value: {\n          ...wtc_data.value[segmentIndex].value ? wtc_data.value[segmentIndex].value : {},\n          ...segment.value,\n        }\n      }\n\n      if( false === wtc_data.value[segmentIndex].success && true === segment.success ) {\n        segment.success = wtc_data.value[segmentIndex].success;\n        segment.errorMessage = wtc_data.value[segmentIndex].errorMessage;\n      }\n\n      let ids = [...new Set([\n        ...segment.value.totals.map( program => program.id ),\n        ...wtc_data.value[segmentIndex].value ? wtc_data.value[segmentIndex].value.totals.map( program => program.id ) : [],\n      ])];\n\n      let totals = ids.map( program => {\n         let wtc_total = wtc_data.value[segmentIndex].value?.totals?.find( item => program === item.id ) ? wtc_data.value[segmentIndex].value.totals.find( item => program === item.id ) : {};        \n         return {\n          ...wtc_total,\n          qm: wtc_total.rdm ? wtc_total.rdm : [0,0,0,0],\n          qd: 0,\n          ...segment.value.totals.find( item => program === item.id ),\n        };\n      } )\n\n      segment.value.totals = totals;\n\n      return segment;\n    } );\n\n    if( false === response.success ) {\n      throw response.errorMessage;\n    }\n\n    response.value.forEach( item => {\n      if( false === item.success ) {\n      throw item.errorMessage;\n    }\n    } )\n\n    console.log(response)\n\n    return response;\n\n  }\n\n  calculate_totals( response ) {\n\n    let totals = response.value.reduce((totals, itinerary) => {\n        itinerary.value.totals.forEach(item => {\n          totals[item.id] = totals[item.id] ? {\n            rdm: totals[item.id].rdm ? totals[item.id].rdm.map( (m, i) => m + item.rdm[i]) : item.rdm,\n            qm: totals[item.id].qm.map( (m, i) => m + item.qm[i]),\n            qd: totals[item.id].qd + item.qd,\n          } : {\n            rdm: item.rdm,\n            qm: item.qm,\n            qd: item.qd,\n          };\n        })\n\n        return totals;\n      }, {} );\n\n    this.display( response, totals );\n\n  }\n\n  display( data, totals ) {\n\n    this.loading_end();\n    \n  }\n\n  loading_start() {\n    this.el_button.disabled = true;\n    this.el_list.innerHTML = '';\n    this.el_loading.classList.remove('hidden');\n    this.el_error.classList.add('hidden');\n    this.el_error.innerHTML = '';\n  }\n\n  loading_end() {\n    this.el_button.disabled = false;\n    this.el_loading.classList.add('hidden');\n  }\n\n  loadParameters() {\n\t\tlet searchParams = new URLSearchParams(location.hash.replace('#',''));\n\t\tlet el = {};\n\t\tfor(let key of searchParams.keys()) {\n\t\t\tel = this.querySelector(`[name=\"${key}\"]`);\n\t\t\tif (el) {\n\t\t\t\t'checkbox' === el.type ? el.checked = 'true' === searchParams.get(key) : el.value = searchParams.get(key);\n\t\t\t}\n\t\t}\n\t}\n\n  update_hash() {\n\t\tlet parameters = {};\n\t\t[...this.querySelectorAll('[name]')].forEach(el => parameters[el.name] = 'checkbox' === el.type ? el.checked : el.value);\n\t\tlocation.hash = (new URLSearchParams(parameters)).toString();\n\t}\n\n}"]}