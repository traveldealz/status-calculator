{"version":3,"sources":["src/miles-calculator-component.js"],"names":["BaseComponent","translate","translations","template","constructor","$template","connectedCallback","renderTemplate","innerHTML","$locale","calculate","$programs","fetch","then","response","json","data","reduce","programs","item","code","display","value","airports","totals","el_list","Object","keys","map","id","program","build","rdmname","rdm","qm_short","qmname","qm","name","programname","collected","statusmiles","en","flat","filter","sort","a","b","forEach","el","document","createElement","text","toLocaleString","appendChild"],"mappings":"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","sourceRoot":"/source_map/","sourcesContent":["import BaseComponent from \"./base-component\";\nimport translate from \"./helper/translate\";\nimport translations from \"./translations\";\nimport template from \"./templates/miles-calculator\";\n\nexport default class extends BaseComponent {\n  constructor() {\n    super();\n    this.$template = template;\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n  }\n\n  renderTemplate() {\n    this.innerHTML\n      ? (this.template = this.innerHTML)\n      : (this.innerHTML = translate(\n          this.$template,\n          translations[this.$locale] ? translations[this.$locale] : []\n        ));\n  }\n\n  calculate() {\n    this.$programs = [];\n    fetch(\"https://mileage.travel-dealz.eu/api/airline_programs\")\n      .then((response) => response.json())\n      .then((data) =>\n        data.reduce((programs, item) => {\n          programs[item.code] = item;\n          return programs;\n        }, {})\n      )\n      .then((programs) => (this.$programs = programs));\n    super.calculate();\n  }\n\n  display({ value: data, programs, airports }, totals) {\n    super.display();\n\n    this.el_list.innerHTML = \"\";\n\n    Object.keys(totals)\n      .map((id) => {\n        const program = this.$programs[id];\n        if (!program) {\n          return [];\n        }\n        let build = { program };\n        if (program.translations) {\n          build.rdmname = program.translations[this.$locale].rdm;\n          program.translations[this.$locale].qm_short\n            ? (build.qmname = program.translations[this.$locale].qm_short)\n            : (build.qmname = program.translations[this.$locale].qm);\n          program.translations[this.$locale].name\n            ? (build.programname = program.translations[this.$locale].name)\n            : (build.programname = program.name);\n        } else {\n          build.rdmname = \"Award Miles\";\n          build.qmname = \"Status Miles\";\n          build.programname = program.name;\n        }\n        build.collected = totals[id].rdm[0];\n        build.statusmiles = totals[id].qm[0] > 1 ? totals[id].qm[0] : 0;\n        if (\n          program.translations.en.rdm == \"Award Miles\" &&\n          program.translations.en.qm == \"Tier Miles\" &&\n          build.statusmiles == build.collected\n        ) {\n          build.rdmname = \"miles\";\n        }\n\n        return build;\n      })\n      .flat()\n      .filter((build) => 1 < build.collected)\n      .flat()\n      .sort((a, b) => b.collected - a.collected)\n      .forEach((item) => {\n        let el = document.createElement(\"li\");\n        let text = `\n        ${item.collected.toLocaleString()} __(${item.rdmname}) \n        ${\n          item.statusmiles != item.collected && item.statusmiles > 1\n            ? \" + \" + item.statusmiles.toLocaleString() + \" \" + item.qmname\n            : \"\"\n        } __(on) ${item.programname} </div>\n        `;\n\n        el.innerHTML = translate(\n          text,\n          translations[this.$locale] ? translations[this.$locale] : []\n        );\n        this.el_list.appendChild(el);\n      });\n  }\n}\n"]}